<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trading Journal Pro (Debug Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-dark { background-color: #1e293b; border: 1px solid #334155; color: white; transition: all 0.2s; }
        .input-dark:focus { border-color: #3b82f6; outline: none; ring: 2px; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .tab-inactive { color: #64748b; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Config Area -->
    <script>
        // ‚ö†Ô∏è‚ö†Ô∏è ‡∏ß‡∏≤‡∏á URL ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚ö†Ô∏è‚ö†Ô∏è
        const scriptURL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLiglfxd3KM4szsrgnyZzvL0hqR_d8ZsZJKzOjwqL8jtTIlMGtMSwuaCrqP1WB7Ik-I6T0KVj-wGuB7sFSVETkNSN30zR3SK9yIXHQmnVv0UXg9iPFwZD72DD3oA0bDYf0pkyL3s12HK7rzEu0J494zztVR-ghqeXVsr4e535lSdbVadZVbHWe0FPrypaujZz-N_E3ob8rpPNBPplGzOt6Uom9vs1tT9dk_TcQbAoNWBFAqsf1PYdN9hlSaU88eC2uu1TWKAzQGEkdEahVZdm813D2RDI6jVh-8Ifn29&lib=MruwxJIRisg5ma7JSjx1F-L3SafOLewCU'; 
    </script>

    <!-- Top Navigation -->
    <nav class="fixed top-0 w-full z-50 glass shadow-lg">
        <div class="max-w-lg mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <i class="fa-solid fa-chart-line text-blue-500 text-xl"></i>
                    <span class="font-bold text-lg tracking-wide">Trader's Journal</span>
                </div>
                <button onclick="fetchData()" class="text-sm bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded-full transition">
                    <i class="fa-solid fa-rotate-right mr-1"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
            <!-- Tabs -->
            <div class="flex border-b border-slate-700">
                <button onclick="switchTab('record')" id="tab-record" class="flex-1 py-3 text-sm font-medium tab-active text-center">
                    <i class="fa-solid fa-pen-to-square mr-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡∏£‡∏î
                </button>
                <button onclick="switchTab('dashboard')" id="tab-dashboard" class="flex-1 py-3 text-sm font-medium tab-inactive text-center">
                    <i class="fa-solid fa-table-columns mr-1"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-lg mx-auto mt-28 px-4">

        <!-- Error Debug Box (‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤) -->
        <div id="debug-box" class="hidden bg-red-900/50 border border-red-500 text-red-200 p-4 rounded-xl mb-4 text-xs font-mono break-all">
        </div>

        <!-- SECTION: RECORD FORM -->
        <div id="view-record" class="animate-fade-in">
            <form id="tradingForm" class="space-y-4">
                
                <!-- Pair & Position -->
                <div class="glass rounded-xl p-4 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-slate-400">‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <select name="Pair" class="w-full input-dark rounded-lg p-2.5 mt-1">
                                <option value="XAUUSD">XAUUSD ü•á</option>
                                <option value="EURUSD">EURUSD üí∂</option>
                                <option value="USDJPY">USDJPY üí¥</option>
                                <option value="GBPJPY">GBPJPY üí∑</option>
                                <option value="BTCUSD">BTCUSD ‚Çø</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400">Lot Size</label>
                            <input type="number" step="0.01" name="Lot" value="0.01" class="w-full input-dark rounded-lg p-2.5 mt-1 text-center" required>
                        </div>
                    </div>

                    <div>
                        <label class="text-xs text-slate-400 block mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Position)</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="Position" value="BUY" class="peer hidden" onchange="calculatePL()">
                                <div class="p-2.5 rounded-lg bg-slate-800 border border-slate-700 text-center peer-checked:bg-green-600 peer-checked:border-green-500 transition font-semibold">BUY üü¢</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="Position" value="SELL" class="peer hidden" onchange="calculatePL()">
                                <div class="p-2.5 rounded-lg bg-slate-800 border border-slate-700 text-center peer-checked:bg-red-600 peer-checked:border-red-500 transition font-semibold">SELL üî¥</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Strategy Checklist -->
                <div class="glass rounded-xl p-4 border-l-4 border-blue-500">
                    <h3 class="text-sm font-semibold text-blue-400 mb-3"><i class="fa-solid fa-list-check"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏£‡∏∞‡∏ö‡∏ö (M15 EMA)</h3>
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition">
                            <input type="checkbox" name="H1 Trend" value="Yes" class="w-5 h-5 rounded text-blue-600 bg-slate-700 border-slate-500 focus:ring-offset-0">
                            <span class="text-sm">H1 ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå (EMA 50)</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition">
                            <input type="checkbox" name="M15 Signal" value="Yes" class="w-5 h-5 rounded text-blue-600 bg-slate-700 border-slate-500 focus:ring-offset-0">
                            <span class="text-sm">M15 EMA 8 ‡∏ï‡∏±‡∏î 21 ‡πÅ‡∏•‡πâ‡∏ß</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition">
                            <input type="checkbox" name="ADX > 20" value="Yes" class="w-5 h-5 rounded text-blue-600 bg-slate-700 border-slate-500 focus:ring-offset-0">
                            <span class="text-sm">ADX > 20 (‡∏°‡∏µ‡πÅ‡∏£‡∏á)</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition">
                            <input type="checkbox" name="Retest" value="Yes" class="w-5 h-5 rounded text-blue-600 bg-slate-700 border-slate-500 focus:ring-offset-0">
                            <span class="text-sm">Retest + ‡∏à‡∏ö‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß</span>
                        </label>
                    </div>
                </div>

                <!-- Pricing & Result -->
                <div class="glass rounded-xl p-4 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-slate-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ (Entry)</label>
                            <input type="number" step="0.01" id="entryPrice" name="Entry" placeholder="Price" class="w-full input-dark rounded-lg p-2.5 mt-1 text-center" oninput="calculatePL()">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≠‡∏Å (Exit)</label>
                            <input type="number" step="0.01" id="exitPrice" name="Exit" placeholder="Price" class="w-full input-dark rounded-lg p-2.5 mt-1 text-center" oninput="calculatePL()">
                        </div>
                    </div>

                    <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs text-slate-400">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (Auto)</label>
                            <span id="pipsCalc" class="text-xs text-slate-500">0 Pips</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <select name="Result" id="resultSelect" class="w-full input-dark rounded-lg p-2.5 text-sm font-semibold">
                                <option value="PENDING">PENDING ‚è≥</option>
                                <option value="WIN">WIN ‚úÖ</option>
                                <option value="LOSS">LOSS ‚ùå</option>
                                <option value="BE">BE ‚öñÔ∏è</option>
                            </select>
                            <input type="number" step="0.01" id="plValue" name="P/L ($)" placeholder="0.00 $" class="w-full bg-transparent border-b border-slate-600 text-right text-lg font-bold focus:outline-none placeholder-slate-600">
                        </div>
                    </div>
                </div>

                <div class="glass rounded-xl p-4">
                    <label class="text-xs text-slate-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                    <textarea name="Notes" rows="2" class="w-full input-dark rounded-lg p-2.5 mt-1 text-sm" placeholder="‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå, ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤..."></textarea>
                </div>

                <input type="hidden" name="Date" id="dateField">
                <input type="hidden" name="Time" id="timeField">

                <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-95 transition flex justify-center items-center text-lg">
                    <i class="fa-solid fa-paper-plane mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </form>
        </div>

        <!-- SECTION: DASHBOARD -->
        <div id="view-dashboard" class="hidden animate-fade-in space-y-4">
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-2 gap-3">
                <div class="glass rounded-xl p-4 text-center border-b-4 border-green-500">
                    <p class="text-xs text-slate-400 uppercase">Win Rate</p>
                    <h2 id="dash-winrate" class="text-2xl font-bold text-white mt-1">--%</h2>
                    <p id="dash-winloss" class="text-xs text-slate-500 mt-1">W:0 L:0</p>
                </div>
                <div class="glass rounded-xl p-4 text-center border-b-4 border-blue-500">
                    <p class="text-xs text-slate-400 uppercase">Net Profit</p>
                    <h2 id="dash-profit" class="text-2xl font-bold text-white mt-1">$0.00</h2>
                    <p class="text-xs text-slate-500 mt-1">Total P/L</p>
                </div>
            </div>

            <!-- More Stats -->
            <div class="glass rounded-xl p-4 flex justify-between items-center">
                <div class="text-center">
                    <p class="text-xs text-slate-400">Total Trades</p>
                    <p id="dash-total" class="text-xl font-bold">0</p>
                </div>
                <div class="h-8 w-px bg-slate-700"></div>
                <div class="text-center">
                    <p class="text-xs text-slate-400">Avg Win</p>
                    <p id="dash-avgwin" class="text-green-400 font-semibold">$0.00</p>
                </div>
                <div class="h-8 w-px bg-slate-700"></div>
                <div class="text-center">
                    <p class="text-xs text-slate-400">Avg Loss</p>
                    <p id="dash-avgloss" class="text-red-400 font-semibold">$0.00</p>
                </div>
            </div>

            <!-- Recent History -->
            <div class="glass rounded-xl overflow-hidden">
                <div class="bg-slate-800/50 p-3 border-b border-slate-700 flex justify-between items-center">
                    <h3 class="text-sm font-semibold"><i class="fa-solid fa-clock-rotate-left mr-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <span class="text-xs text-slate-500">5 ‡πÑ‡∏°‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                </div>
                <div id="history-list" class="divide-y divide-slate-700">
                    <!-- Loading State -->
                    <div class="p-4 text-center text-slate-500 text-sm">
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                    </div>
                </div>
            </div>
            
            <div class="text-center text-xs text-slate-600 mt-4">
                ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏à‡∏≤‡∏Å Google Sheet
            </div>
        </div>

    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-800 border border-slate-600 text-white px-6 py-3 rounded-full shadow-2xl flex items-center space-x-3 transition-all duration-300 translate-y-20 opacity-0 z-50">
        <i id="toast-icon" class=""></i>
        <span id="toast-msg" class="text-sm font-medium"></span>
    </div>

    <script>
        // --- LOGIC ---
        function switchTab(tab) {
            const recordView = document.getElementById('view-record');
            const dashView = document.getElementById('view-dashboard');
            const tabRecord = document.getElementById('tab-record');
            const tabDash = document.getElementById('tab-dashboard');

            if(tab === 'record') {
                recordView.classList.remove('hidden');
                dashView.classList.add('hidden');
                tabRecord.className = "flex-1 py-3 text-sm font-medium tab-active text-center";
                tabDash.className = "flex-1 py-3 text-sm font-medium tab-inactive text-center";
            } else {
                recordView.classList.add('hidden');
                dashView.classList.remove('hidden');
                tabRecord.className = "flex-1 py-3 text-sm font-medium tab-inactive text-center";
                tabDash.className = "flex-1 py-3 text-sm font-medium tab-active text-center";
                fetchData(); 
            }
        }

        // Auto Calculate P/L
        function calculatePL() {
            const entry = parseFloat(document.getElementById('entryPrice').value);
            const exit = parseFloat(document.getElementById('exitPrice').value);
            const lot = parseFloat(document.querySelector('input[name="Lot"]').value);
            const position = document.querySelector('input[name="Position"]:checked')?.value;
            const plInput = document.getElementById('plValue');
            const resultSelect = document.getElementById('resultSelect');
            const pipsLabel = document.getElementById('pipsCalc');

            if (entry && exit && position && lot) {
                let diff = 0;
                if (position === 'BUY') diff = exit - entry;
                if (position === 'SELL') diff = entry - exit;

                const pair = document.querySelector('select[name="Pair"]').value;
                let profit = 0;
                let points = 0;

                if(pair.includes('XAU') || pair.includes('BTC')) {
                    profit = diff * lot * 100;
                    points = diff * 100;
                } else if (pair.includes('JPY')) {
                    profit = diff * lot * 1000;
                    points = diff * 100; 
                } else {
                    profit = diff * lot * 100000;
                    points = diff * 100000;
                }

                plInput.value = profit.toFixed(2);
                pipsLabel.innerText = Math.round(points) + " Points";

                if(profit > 0) {
                    plInput.style.color = '#4ade80';
                    resultSelect.value = 'WIN';
                } else if (profit < 0) {
                    plInput.style.color = '#f87171';
                    resultSelect.value = 'LOSS';
                } else {
                    plInput.style.color = 'white';
                    resultSelect.value = 'BE';
                }
            }
        }

        // Fetch Data for Dashboard (DEBUG VERSION)
        function fetchData() {
            const historyList = document.getElementById('history-list');
            const debugBox = document.getElementById('debug-box');
            
            if (scriptURL === 'YOUR_WEB_APP_URL_HERE' || scriptURL === '') {
                debugBox.classList.remove('hidden');
                debugBox.innerText = "‚ùå Error: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏Ñ‡∏£‡∏±‡∏ö";
                return;
            }

            fetch(scriptURL)
            .then(res => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÑ‡∏´‡∏°
                const contentType = res.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    return res.json();
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ Error (‡πÄ‡∏ä‡πà‡∏ô‡∏™‡πà‡∏á HTML ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤)
                    return res.text().then(text => {
                        throw new Error("API ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏•‡∏Å‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON): " + text.substring(0, 100));
                    });
                }
            })
            .then(data => {
                debugBox.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô Debug ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                processStats(data);
            })
            .catch(err => {
                console.error(err);
                debugBox.classList.remove('hidden');
                debugBox.innerHTML = `‚ö†Ô∏è <b>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:</b><br>${err.message}<br><br>üëâ <b>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:</b> ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ Sheet ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á Deploy ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                historyList.innerHTML = '<div class="p-4 text-center text-red-400 text-sm">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
            });
        }

        function processStats(rows) {
            let wins = 0;
            let losses = 0;
            let totalPL = 0;
            let totalTrades = rows.length;
            let totalWinAmt = 0;
            let totalLossAmt = 0;
            let winCount = 0;
            let lossCount = 0;

            let historyHTML = '';
            const recent = rows.slice(-5).reverse();

            recent.forEach(row => {
                // Column Map: Pair=2, Pos=3, Result=7, PL=8
                const pair = row[2];
                const pos = row[3];
                const res = row[7];
                const pl = parseFloat(row[8]) || 0;
                const plClass = pl >= 0 ? 'text-green-400' : 'text-red-400';
                const icon = pos === 'BUY' ? 'fa-arrow-trend-up text-green-500' : 'fa-arrow-trend-down text-red-500';

                historyHTML += `
                <div class="p-3 flex justify-between items-center hover:bg-slate-800 transition">
                    <div class="flex items-center space-x-3">
                        <div class="bg-slate-700 w-10 h-10 rounded-full flex justify-center items-center">
                            <i class="fa-solid ${icon}"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-200">${pair}</p>
                            <p class="text-xs text-slate-500">${pos} ‚Ä¢ ${res}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold ${plClass}">${pl > 0 ? '+' : ''}${pl.toFixed(2)}$</p>
                        <p class="text-xs text-slate-500">P/L</p>
                    </div>
                </div>`;
            });

            document.getElementById('history-list').innerHTML = historyHTML || '<div class="p-4 text-center text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';

            rows.forEach(row => {
                const res = row[7];
                const pl = parseFloat(row[8]) || 0;

                totalPL += pl;

                if (res === 'WIN') {
                    wins++;
                    totalWinAmt += pl;
                    winCount++;
                } else if (res === 'LOSS') {
                    losses++;
                    totalLossAmt += pl; 
                    lossCount++;
                }
            });

            const winRate = totalTrades > 0 ? ((wins / totalTrades) * 100).toFixed(1) : 0;
            const avgWin = winCount > 0 ? (totalWinAmt / winCount).toFixed(2) : 0;
            const avgLoss = lossCount > 0 ? (totalLossAmt / lossCount).toFixed(2) : 0;

            document.getElementById('dash-winrate').innerText = `${winRate}%`;
            document.getElementById('dash-winrate').className = `text-2xl font-bold mt-1 ${winRate >= 50 ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('dash-winloss').innerText = `W:${wins} L:${losses} D:${totalTrades - wins - losses}`;
            
            document.getElementById('dash-profit').innerText = `${totalPL > 0 ? '+' : ''}${totalPL.toFixed(2)}$`;
            document.getElementById('dash-profit').className = `text-2xl font-bold mt-1 ${totalPL >= 0 ? 'text-blue-400' : 'text-red-400'}`;

            document.getElementById('dash-total').innerText = totalTrades;
            document.getElementById('dash-avgwin').innerText = `$${avgWin}`;
            document.getElementById('dash-avgloss').innerText = `$${avgLoss}`;
        }


        // Form Submission
        const form = document.forms['tradingForm'];
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const now = new Date();
            document.getElementById('dateField').value = now.toLocaleDateString('th-TH');
            document.getElementById('timeField').value = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });

            const formData = new FormData(form);
            const dataObj = {};
            formData.forEach((value, key) => { dataObj[key] = value });
            
            ['H1 Trend', 'M15 Signal', 'ADX > 20', 'Retest'].forEach(name => {
                if(!dataObj[name]) dataObj[name] = "No";
            });

            fetch(scriptURL, { method: 'POST', body: JSON.stringify(dataObj) })
            .then(response => {
                showToast('success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏•‡∏°‡∏≤‡πÄ‡∏ó‡∏°‡∏≤');
                form.reset();
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                // Refresh dashboard if needed
                // fetchData();
            })
            .catch(error => {
                console.error('Error!', error.message);
                showToast('error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏ô‡πà‡∏≠‡∏¢');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
            });
        });

        function showToast(type, msg) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const text = document.getElementById('toast-msg');

            toast.classList.remove('translate-y-20', 'opacity-0');
            text.innerText = msg;

            if(type === 'success') {
                icon.className = "fa-solid fa-circle-check text-green-400 text-xl";
                toast.classList.add('border-green-500');
            } else {
                icon.className = "fa-solid fa-circle-xmark text-red-400 text-xl";
                toast.classList.add('border-red-500');
            }

            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>

